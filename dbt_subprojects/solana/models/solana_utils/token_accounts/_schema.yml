version: 2

models:
  - name: solana_utils_spl_token_accounts_raw
    meta:
      blockchain: solana
      contributors: [jeff-dude, 0xBoxer, ilemi]
    config:
      tags: ['solana','token_accounts']
    description: >
        raw token account events from spl_token decoded tables
    dbt_tests:
        - unique_combination_of_columns:
            combination_of_columns:
                - block_date
                - token_account
                - token_account_prefix
                - unique_instruction_key
    columns:
      - name: block_date
      - name: block_time
      - name: token_account
      - name: token_account_prefix
      - name: event_type
      - name: account_owner
      - name: account_mint
      - name: unique_instruction_key
      - name: block_slot
      - name: tx_index
      - name: outer_instruction_index
      - name: inner_instruction_index

  - name: solana_utils_spl_token_accounts_state_history
    meta:
      blockchain: solana
      contributors: [jeff-dude, 0xBoxer, ilemi]
    config:
      tags: ['solana','token_accounts']
    description: >
        token account historical states. one active row, rest are historical.
    dbt_tests:
        - unique_combination_of_columns:
            combination_of_columns:
                - block_date
                - token_account
                - token_account_prefix
                - unique_instruction_key
    columns:
      - name: token_account
      - name: token_account_prefix
      - name: event_type
      - name: token_balance_owner
      - name: token_mint_address
      - name: block_date
      - name: valid_from_unique_instruction_key
      - name: valid_to_unique_instruction_key
      - name: is_active

  - name: solana_utils_spl_token_accounts
    meta:
      blockchain: solana
      contributors: [jeff-dude, 0xBoxer, ilemi]
    config:
      tags: ['solana','token_accounts']
    description: >
        final token account table, partioned by token account prefix for downstream join performance.
    dbt_tests:
        - unique_combination_of_columns:
            combination_of_columns:
                - token_account
                - token_account_prefix
                - unique_instruction_key
    columns:
      - name: token_account
      - name: token_account_prefix
      - name: event_type
      - name: token_balance_owner
      - name: token_mint_address
      - name: block_date
      - name: valid_from_unique_instruction_key
      - name: valid_to_unique_instruction_key
      - name: is_active
      - name: account_type

  - name: solana_utils_spl_token_2022_accounts_raw
    meta:
      blockchain: solana
      contributors: [jeff-dude, 0xBoxer, ilemi]
    config:
      tags: ['solana','token_accounts']
    description: >
        raw token account events from spl_token_2022 decoded tables
    dbt_tests:
        - unique_combination_of_columns:
            combination_of_columns:
                - block_date
                - token_account
                - token_account_prefix
                - unique_instruction_key
    columns:
      - name: block_date
      - name: block_time
      - name: token_account
      - name: token_account_prefix
      - name: event_type
      - name: account_owner
      - name: account_mint
      - name: unique_instruction_key
      - name: block_slot
      - name: tx_index
      - name: outer_instruction_index
      - name: inner_instruction_index

  - name: solana_utils_spl_token_2022_accounts_state_history
    meta:
      blockchain: solana
      contributors: [jeff-dude, 0xBoxer, ilemi]
    config:
      tags: ['solana','token_accounts']
    description: >
        token account historical states. one active row, rest are historical.
    dbt_tests:
        - unique_combination_of_columns:
            combination_of_columns:
                - block_date
                - token_account
                - token_account_prefix
                - unique_instruction_key
    columns:
      - name: token_account
      - name: token_account_prefix
      - name: event_type
      - name: token_balance_owner
      - name: token_mint_address
      - name: block_date
      - name: valid_from_unique_instruction_key
      - name: valid_to_unique_instruction_key
      - name: is_active

  - name: solana_utils_spl_token_2022_accounts
    meta:
      blockchain: solana
      contributors: [jeff-dude, 0xBoxer, ilemi]
    config:
      tags: ['solana','token_accounts']
    description: >
        final token account table, partioned by token account prefix for downstream join performance.
    dbt_tests:
        - unique_combination_of_columns:
            combination_of_columns:
                - token_account
                - token_account_prefix
                - unique_instruction_key
    columns:
      - name: token_account
      - name: token_account_prefix
      - name: event_type
      - name: token_balance_owner
      - name: token_mint_address
      - name: block_date
      - name: valid_from_unique_instruction_key
      - name: valid_to_unique_instruction_key
      - name: is_active
      - name: account_type

  - name: solana_utils_token_accounts
    meta:
      blockchain: solana
      contributors: [jeff-dude, 0xBoxer, ilemi]
    config:
      tags: ['solana','token_accounts']
    description: >
        final token account view, union of spl_token and spl_token_2022.
    columns:
      - name: token_account
      - name: token_account_prefix
      - name: event_type
      - name: token_balance_owner
      - name: token_mint_address
      - name: block_date
      - name: valid_from_unique_instruction_key
      - name: valid_to_unique_instruction_key
      - name: is_active
      - name: account_type
